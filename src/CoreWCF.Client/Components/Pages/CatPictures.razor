@page "/catpictures"
@using CoreWCF.Client.Services
@inject ICatInformationProvider CatInformationProvider

<PageTitle>Cat Pictures Service</PageTitle>

<h1>Cat Pictures Service</h1>

<button class="btn btn-primary" @onclick="GetCatPicture">Get Cat Picture</button>

<div class="mt-3">
    @if (_isLoading)
    {
        <p>Loading...</p>
    }
    else if (_catImageData != null)
    {
        <p>Here is your kitty!</p>
        <img src="@GetImageSource()" alt="Cat" style="max-width: 500px;" />
    }
    else if (_hasError)
    {
        <p class="text-danger">@_errorMessage</p>
        <img src="/images/error.jpg" alt="Placeholder cat" style="max-width: 500px;" />
    }
</div>

@code {
    private byte[]? _catImageData;
    private bool _isLoading;
    private bool _hasError;
    private string? _errorMessage;

    private async Task GetCatPicture()
    {
        _isLoading = true;
        _hasError = false;
        _catImageData = null;

        var result = await CatInformationProvider.GetCatPictureAsync();

        if (result.IsSuccess)
        {
            _catImageData = result.Value;
        }
        else
        {
            _hasError = true;
            _errorMessage = result.Error;
        }

        _isLoading = false;
    }

    private string GetImageSource()
    {
        if (_catImageData == null) return string.Empty;
        var base64 = Convert.ToBase64String(_catImageData);
        return $"data:image/jpeg;base64,{base64}";
    }
}